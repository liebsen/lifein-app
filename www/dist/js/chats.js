;var node=location.hash.split(':')[0],node=node.replace('#',''),currentnode='/chat_mensajes/'+node,chat_mensajes=firebase.database().ref(currentnode),datosdeapoyo={},anim=LI.animation.transition,showItem=function(e){e=e.replace(node+':','');$('body').attr('key',e);LI.setScroll();var a=[];$('.spinner').fadeIn(anim.fadeIn*anim.factor,function(){var n=e.split('_')[0],t=e.split('_')[1];firebase.database().ref('cuentas/'+node+'/'+n).once('value').then(function(i){a[i.key]=i.val();firebase.database().ref('cuentas/'+node+'/'+t).once('value').then(function(t){a[t.key]=t.val();firebase.database().ref(currentnode+'/'+e).once('value').then(function(e){var t=[];e.forEach(function(e){var n=e.val();n.sender=a[n.from];t.push(n)});$('#detail').html($.templates('#form').render({key:e.key,data:t,userkey:n},LI)).promise().done(function(){$('.lista').fadeOut(anim.fadeOut,function(){$('.spinner').fadeOut(anim.fadeOut*anim.factor,function(){$('#detail').delay(200).fadeIn(anim.fadeOut*anim.factor,function(){$('body,html').scrollTop(0)})})})})})})})})};chat_mensajes.once('value').then(function(e){if(!e.val()){$('.spinner').fadeOut(anim.fadeOut,function(){$('.lista').delay(anim.delay).fadeIn()})}});firebase.database().ref('/datosdeapoyo').once('value').then(function(e){datosdeapoyo=e.val()});$(document).on('click','.cerrar',function(){location.hash=node});$(function(){$(window).on('hashchange',function(){if(location.hash.indexOf(':')>-1){showItem(location.hash.replace('#',''))}
else{$('#detail').fadeOut(anim.fadeOut,function(){$('.lista').delay(anim.delay).fadeIn(anim.fadeIn,function(){LI.resetScroll()})})}}).trigger('hashchange')});chat_mensajes.on('child_added',(data)=>{var item=data.val(),itemKey=data.key,user1={};var user2={};var user1Key=itemKey.split('_')[0],user2Key=itemKey.split('_')[1];firebase.database().ref('/cuentas/'+node+'/'+user1Key).once('value').then(function(e){e=e.val();firebase.database().ref('/cuentas/'+node+'/'+user2Key).once('value').then(function(a){a=a.val();$('#list').prepend($.templates('#item').render({node:node,key:itemKey,user1:e,user2:a},LI.aux)).promise().done(function(){$('#list').find('#'+data.key).animateAdded()})})});if(location.hash.indexOf(':')==-1){$('.spinner').fadeOut(anim.fadeOut)}});chat_mensajes.on('child_changed',(data)=>{var index=$('#'+data.key).index();$('#'+data.key).remove();$('#list').insertAt(index,$.templates('#item').render({key:data.key,data:data.val()},LI.aux));$('#'+data.key).animateChanged()});chat_mensajes.on('child_removed',(data)=>{$('#'+data.key).animateRemoved(function(){$(this).remove()})});